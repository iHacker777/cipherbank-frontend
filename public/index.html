<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />

    <!-- ==================== BASIC META TAGS ==================== -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes, viewport-fit=cover" />
    <meta name="description" content="CipherBank - Enterprise-grade automated bank statement parsing and financial data management platform with secure processing" />
    <meta name="keywords" content="bank statement, parsing, financial, automated, CipherBank, statement processing, fintech, banking" />
    <meta name="author" content="The PayTrix" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- ==================== PWA MANIFEST ==================== -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />

    <!-- ==================== FAVICON ==================== -->
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico" />

    <!-- ==================== iOS SPECIFIC META TAGS ==================== -->

    <!-- Web App Capable - Makes app run in standalone mode -->
    <meta name="apple-mobile-web-app-capable" content="yes" />

    <!-- Status Bar Style - iOS 18 optimized -->
    <!-- black-translucent provides best experience with Dynamic Island -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <!-- App Title - Name shown on iOS home screen -->
    <meta name="apple-mobile-web-app-title" content="CipherBank" />

    <!-- Format Detection - Prevents iOS auto-detection -->
    <meta name="format-detection" content="telephone=no" />
    <meta name="format-detection" content="date=no" />
    <meta name="format-detection" content="address=no" />
    <meta name="format-detection" content="email=no" />

    <!-- ==================== iOS TOUCH ICONS ==================== -->
    <!-- Primary Touch Icon -->
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/icons/apple-touch-icon.png" />

    <!-- Touch Icons for Different iOS Devices -->
    <link rel="apple-touch-icon" sizes="120x120" href="%PUBLIC_URL%/icons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="%PUBLIC_URL%/icons/apple-touch-icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="167x167" href="%PUBLIC_URL%/icons/apple-touch-icon-167x167.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="%PUBLIC_URL%/icons/apple-touch-icon-180x180.png" />

    <!-- ==================== iOS 18 SPLASH SCREENS ==================== -->
    <!-- iPhone 15 Pro Max / 16 Pro Max (430x932) -->
    <link rel="apple-touch-startup-image" media="screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="%PUBLIC_URL%/splash/iphone-15-pro-max-portrait.png" />
    <link rel="apple-touch-startup-image" media="screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="%PUBLIC_URL%/splash/iphone-15-pro-max-landscape.png" />

    <!-- iPhone 15 Pro / 16 Pro (393x852) -->
    <link rel="apple-touch-startup-image" media="screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="%PUBLIC_URL%/splash/iphone-15-pro-portrait.png" />
    <link rel="apple-touch-startup-image" media="screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="%PUBLIC_URL%/splash/iphone-15-pro-landscape.png" />

    <!-- iPhone 15 / 16 (390x844) -->
    <link rel="apple-touch-startup-image" media="screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="%PUBLIC_URL%/splash/iphone-15-portrait.png" />
    <link rel="apple-touch-startup-image" media="screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="%PUBLIC_URL%/splash/iphone-15-landscape.png" />

    <!-- iPhone 14 Pro Max / 13 Pro Max (428x926) -->
    <link rel="apple-touch-startup-image" media="screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="%PUBLIC_URL%/splash/iphone-14-pro-max-portrait.png" />
    <link rel="apple-touch-startup-image" media="screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="%PUBLIC_URL%/splash/iphone-14-pro-max-landscape.png" />

    <!-- iPhone SE (375x667) -->
    <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="%PUBLIC_URL%/splash/iphone-se-portrait.png" />
    <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="%PUBLIC_URL%/splash/iphone-se-landscape.png" />

    <!-- iPad Pro 12.9" (1024x1366) -->
    <link rel="apple-touch-startup-image" media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="%PUBLIC_URL%/splash/ipad-pro-12-9-portrait.png" />
    <link rel="apple-touch-startup-image" media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="%PUBLIC_URL%/splash/ipad-pro-12-9-landscape.png" />

    <!-- iPad Pro 11" (834x1194) -->
    <link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="%PUBLIC_URL%/splash/ipad-pro-11-portrait.png" />
    <link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="%PUBLIC_URL%/splash/ipad-pro-11-landscape.png" />

    <!-- ==================== THEME COLOR (iOS 18 Dynamic) ==================== -->
    <!-- Standard theme color for all browsers -->
    <meta name="theme-color" content="#007AFF" />

    <!-- iOS 18 Dark Mode Support -->
    <meta name="theme-color" content="#007AFF" media="(prefers-color-scheme: light)" />
    <meta name="theme-color" content="#0A84FF" media="(prefers-color-scheme: dark)" />

    <!-- ==================== MICROSOFT TILES ==================== -->
    <meta name="msapplication-TileColor" content="#007AFF" />
    <meta name="msapplication-TileImage" content="%PUBLIC_URL%/icons/ms-icon-144x144.png" />
    <meta name="msapplication-config" content="%PUBLIC_URL%/browserconfig.xml" />

    <!-- ==================== PERFORMANCE OPTIMIZATIONS ==================== -->
    <!-- DNS Prefetch -->
    <link rel="dns-prefetch" href="//cipher.thepaytrix.com" />
    <link rel="dns-prefetch" href="//testing.thepaytrix.com" />

    <!-- Preconnect to API domains -->
    <link rel="preconnect" href="https://cipher.thepaytrix.com" crossorigin />
    <link rel="preconnect" href="https://testing.thepaytrix.com" crossorigin />

    <!-- Preload critical resources -->
    <link rel="preload" as="style" href="%PUBLIC_URL%/static/css/main.css" />
    <link rel="preload" as="script" href="%PUBLIC_URL%/static/js/main.js" />

    <!-- ==================== SECURITY ==================== -->
    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' 'unsafe-eval';
        style-src 'self' 'unsafe-inline';
        img-src 'self' data: https:;
        font-src 'self' data:;
        connect-src 'self' https://cipher.thepaytrix.com https://testing.thepaytrix.com;
        frame-src 'none';
        object-src 'none';
        base-uri 'self';
        form-action 'self';
        upgrade-insecure-requests;
    " />

    <!-- Referrer Policy -->
    <meta name="referrer" content="strict-origin-when-cross-origin" />

    <!-- ==================== SOCIAL MEDIA / OPEN GRAPH ==================== -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="CipherBank - Automated Statement Parsing" />
    <meta property="og:description" content="Enterprise-grade bank statement processing and financial data management platform" />
    <meta property="og:image" content="%PUBLIC_URL%/icons/og-image.png" />
    <meta property="og:url" content="https://cipher.thepaytrix.com" />
    <meta property="og:site_name" content="CipherBank" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="CipherBank - Automated Statement Parsing" />
    <meta name="twitter:description" content="Enterprise-grade bank statement processing and financial data management platform" />
    <meta name="twitter:image" content="%PUBLIC_URL%/icons/twitter-image.png" />

    <!-- ==================== ACCESSIBILITY ==================== -->
    <meta name="color-scheme" content="light dark" />

    <title>CipherBank - Automated Statement Parsing</title>

    <!-- ==================== iOS 18 OPTIMIZED STYLES ==================== -->
    <style>
        /* Critical CSS for iOS 18 */

        /* Prevent text size adjustment */
        html {
          -webkit-text-size-adjust: 100%;
          text-size-adjust: 100%;
        }

        /* Prevent tap highlight */
        * {
          -webkit-tap-highlight-color: transparent;
        }

        /* Safe area insets */
        body {
          padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
          margin: 0;
          font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'SF Pro Display', 'Helvetica Neue', Arial, sans-serif;
        }

        /* Smooth scrolling */
        * {
          -webkit-overflow-scrolling: touch;
        }

        /* Prevent pull-to-refresh */
        body {
          overscroll-behavior-y: contain;
        }

        /* Loading screen - iOS 18 styled */
        #loading-screen {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 9999;
          transition: opacity 0.5s ease-out;
        }

        #loading-screen.hidden {
          opacity: 0;
          pointer-events: none;
        }

        .loading-content {
          text-align: center;
          color: white;
        }

        .loading-logo {
          width: 88px;
          height: 88px;
          margin: 0 auto 24px;
          background: rgba(255, 255, 255, 0.2);
          backdrop-filter: blur(20px);
          -webkit-backdrop-filter: blur(20px);
          border-radius: 24px;
          display: flex;
          align-items: center;
          justify-content: center;
          box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
          border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .loading-spinner {
          width: 44px;
          height: 44px;
          border: 4px solid rgba(255, 255, 255, 0.3);
          border-top-color: white;
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }

        .loading-text {
          font-size: 17px;
          font-weight: 600;
          margin-top: 12px;
          letter-spacing: -0.4px;
        }

        .loading-subtext {
          font-size: 13px;
          font-weight: 400;
          margin-top: 8px;
          opacity: 0.8;
          letter-spacing: -0.08px;
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
          #loading-screen {
            background: linear-gradient(135deg, #0A84FF 0%, #5E5CE6 100%);
          }
        }
    </style>
</head>
<body>
<!-- ==================== LOADING SCREEN ==================== -->
<div id="loading-screen">
    <div class="loading-content">
        <div class="loading-logo">
            <div class="loading-spinner"></div>
        </div>
        <div class="loading-text">Loading CipherBank</div>
        <div class="loading-subtext">Secure Statement Processing</div>
    </div>
</div>

<!-- ==================== NO JAVASCRIPT FALLBACK ==================== -->
<noscript>
    <div style="
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            text-align: center;
            background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
        ">
        <div style="
                max-width: 400px;
                background: white;
                padding: 40px;
                border-radius: 24px;
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            ">
            <h1 style="color: #1f2937; margin-bottom: 16px; font-size: 24px; font-weight: 700;">JavaScript Required</h1>
            <p style="color: #6b7280; margin-bottom: 24px; line-height: 1.6;">
                CipherBank requires JavaScript to function properly. Please enable JavaScript in your browser settings and reload the page.
            </p>
            <button onclick="window.location.reload()" style="
                    background: #007AFF;
                    color: white;
                    padding: 12px 24px;
                    border: none;
                    border-radius: 12px;
                    font-weight: 600;
                    font-size: 15px;
                    cursor: pointer;
                    box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
                ">
                Reload Page
            </button>
        </div>
    </div>
</noscript>

<!-- ==================== ROOT DIV ==================== -->
<div id="root"></div>

<!-- ==================== SERVICE WORKER & PWA SETUP ==================== -->
<script>
    // Hide loading screen when React app loads
    window.addEventListener('load', () => {
      setTimeout(() => {
        const loadingScreen = document.getElementById('loading-screen');
        if (loadingScreen) {
          loadingScreen.classList.add('hidden');
          setTimeout(() => {
            loadingScreen.remove();
          }, 500);
        }
      }, 300);
    });

    // Enhanced Service Worker Registration
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker
          .register('/service-worker.js', {
            scope: '/',
            updateViaCache: 'none'
          })
          .then(registration => {
            console.log('âœ… Service Worker registered:', registration.scope);

            // Check for updates every 60 seconds
            setInterval(() => {
              registration.update();
            }, 60000);

            // Listen for new service worker
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;

              newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  // New service worker available
                  console.log('ðŸ”„ New version available');

                  // Show update notification
                  if (confirm('A new version of CipherBank is available. Update now?')) {
                    newWorker.postMessage({ type: 'SKIP_WAITING' });
                    window.location.reload();
                  }
                }
              });
            });
          })
          .catch(error => {
            console.warn('âš ï¸ Service Worker registration failed:', error);
          });

        // Handle controller change
        navigator.serviceWorker.addEventListener('controllerchange', () => {
          console.log('ðŸ”„ Service Worker controller changed');
          window.location.reload();
        });
      });
    }

    // iOS Detection and Setup
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
    const isStandalone = window.navigator.standalone ||
                        window.matchMedia('(display-mode: standalone)').matches;

    if (isIOS) {
      document.documentElement.classList.add('ios-device');
      console.log('ðŸ“± iOS device detected');

      if (isStandalone) {
        document.documentElement.classList.add('ios-standalone');
        console.log('ðŸ“± Running in iOS standalone mode');
      }

      // Dynamic viewport height for iOS
      const setVH = () => {
        const vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty('--vh', `${vh}px`);
      };

      setVH();
      window.addEventListener('resize', setVH);
      window.addEventListener('orientationchange', setVH);
    }

    // Prevent iOS zoom on double-tap
    let lastTouchEnd = 0;
    document.addEventListener('touchend', (event) => {
      const now = Date.now();
      if (now - lastTouchEnd <= 300) {
        event.preventDefault();
      }
      lastTouchEnd = now;
    }, false);

    // Prevent iOS zoom gesture
    document.addEventListener('gesturestart', (e) => {
      e.preventDefault();
    });

    // Handle viewport changes (keyboard)
    if (isIOS && window.visualViewport) {
      window.visualViewport.addEventListener('resize', () => {
        const vh = window.visualViewport.height * 0.01;
        document.documentElement.style.setProperty('--vh', `${vh}px`);
      });
    }

    // Performance monitoring
    if ('PerformanceObserver' in window) {
      try {
        const observer = new PerformanceObserver((list) => {
          for (const entry of list.getEntries()) {
            console.log(`${entry.name}: ${entry.duration}ms`);
          }
        });
        observer.observe({ entryTypes: ['measure', 'navigation'] });
      } catch (e) {
        // PerformanceObserver not supported
      }
    }

    // Log app info
    console.log('%cCipherBank PWA', 'color: #007AFF; font-size: 24px; font-weight: bold');
    console.log('%cVersion: 2.0.0', 'color: #5856D6; font-size: 14px');
    console.log('%ciOS 18 Optimized', 'color: #34C759; font-size: 12px');
</script>
</body>
</html>